<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Using the PRISM API | PRISM: PROGRAMMABLE INTERFACE FOR STATISTICAL &amp; SIMULATION MODELS</title>
  <meta name="description" content="3 Using the PRISM API | PRISM: PROGRAMMABLE INTERFACE FOR STATISTICAL &amp; SIMULATION MODELS" />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Using the PRISM API | PRISM: PROGRAMMABLE INTERFACE FOR STATISTICAL &amp; SIMULATION MODELS" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Using the PRISM API | PRISM: PROGRAMMABLE INTERFACE FOR STATISTICAL &amp; SIMULATION MODELS" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="section-api.html">

<script src="book_assets/jquery-2.2.3/jquery.min.js"></script>
<link href="book_assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










<link rel="stylesheet" href="pretty-styles.css" type="text/css" />
<link rel="stylesheet" href="cayman.css" type="text/css" />
<link rel="stylesheet" href="python.css" type="text/css" />
<link rel="stylesheet" href="shadow.css" type="text/css" />
<link rel="stylesheet" href="index.html" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="section-introduction.html"><a href="section-introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="section-api.html"><a href="section-api.html"><i class="fa fa-check"></i><b>2</b> Application Programming Interface (API)</a><ul>
<li class="chapter" data-level="" data-path="section-api.html"><a href="section-api.html#section-what-is-an-api"><i class="fa fa-check"></i>What is an API?</a></li>
<li class="chapter" data-level="" data-path="section-api.html"><a href="section-api.html#section-rest"><i class="fa fa-check"></i>REST</a><ul>
<li class="chapter" data-level="" data-path="section-api.html"><a href="section-api.html#section-get"><i class="fa fa-check"></i>GET</a></li>
<li class="chapter" data-level="" data-path="section-api.html"><a href="section-api.html#section-post"><i class="fa fa-check"></i>POST</a></li>
<li class="chapter" data-level="" data-path="section-api.html"><a href="section-api.html#section-put"><i class="fa fa-check"></i>PUT</a></li>
<li class="chapter" data-level="" data-path="section-api.html"><a href="section-api.html#section-delete"><i class="fa fa-check"></i>DELETE</a></li>
<li class="chapter" data-level="" data-path="section-api.html"><a href="section-api.html#section-summary"><i class="fa fa-check"></i>Summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="section-using-prism.html"><a href="section-using-prism.html"><i class="fa fa-check"></i><b>3</b> Using the PRISM API</a><ul>
<li class="chapter" data-level="3.1" data-path="section-using-prism.html"><a href="section-using-prism.html#section-api-in-excel"><i class="fa fa-check"></i><b>3.1</b> PRISM API in Excel</a><ul>
<li class="chapter" data-level="" data-path="section-using-prism.html"><a href="section-using-prism.html#section-downloading-the-spreadsheet"><i class="fa fa-check"></i>Downloading the Spreadsheet</a></li>
<li class="chapter" data-level="" data-path="section-using-prism.html"><a href="section-using-prism.html#section-setting-the-inputs"><i class="fa fa-check"></i>Setting the Inputs</a></li>
<li class="chapter" data-level="" data-path="section-using-prism.html"><a href="section-using-prism.html#section-running-the-model"><i class="fa fa-check"></i>Running the Model</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="section-using-prism.html"><a href="section-using-prism.html#section-api-in-R"><i class="fa fa-check"></i><b>3.2</b> PRISM API in R/Python/Bash/Javascript</a><ul>
<li class="chapter" data-level="" data-path="section-using-prism.html"><a href="section-using-prism.html#section-get-1"><i class="fa fa-check"></i>GET</a></li>
<li class="chapter" data-level="" data-path="section-using-prism.html"><a href="section-using-prism.html#section-post-1"><i class="fa fa-check"></i>POST</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">PRISM: PROGRAMMABLE INTERFACE FOR STATISTICAL &amp; SIMULATION MODELS</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="section-using-prism" class="section level1">
<h1><span class="header-section-number">3</span> Using the PRISM API</h1>
<p>If you don’t have much programming experience, or if you want to use Excel, I would recommend doing the <a href="section-using-prism.html#section-api-in-excel">API in Excel</a>. Otherwise, you can choose your favourite programming language to get started: <a href="section-using-prism.html#section-api-in-R">API in R/Python/Javascript/Bash</a></p>
<div id="section-api-in-excel" class="section level2">
<h2><span class="header-section-number">3.1</span> PRISM API in Excel</h2>
<p>One of the primary goals of PRISM is making prediction models accessible to a wide range of audiences, including those with less programming experience. The Excel API is targetted towards users who are less familiar with programming, or users who are familiar with programming and would like an easy way to extract the data quickly.</p>
<p>For this tutorial, I am going to be using the <strong>accept</strong> model (ACute COPD Exacerbation Prediction Tool). To use the model, you will need to have a spreadsheet program on your computer. Excel is recommended, but Numbers (Mac) will also work.</p>
<p>Before getting started, I recommend that you read the <a href="https://resplab.github.io/acceptManual/section-introduction.html">ACCEPT Manual</a>, specifically Section 2 (The Study) and Section 3 (Using the Package in R).</p>
<div id="section-downloading-the-spreadsheet" class="section level3 unnumbered">
<h3>Downloading the Spreadsheet</h3>
<p>To get started, you will need to go to:</p>
<p><a href="http://resp.core.ubc.ca/ipress/prism">PRISM Model Repository</a>.</p>
<p>In the row that has the <strong>ACCEPT</strong> model, go to the column labelled <strong>Excel Interface</strong> and click on the link <strong>ACCEPT Excel (PC)</strong>. This will download the Excel Interface for the <strong>ACCEPT</strong> model.</p>
</div>
<div id="section-setting-the-inputs" class="section level3 unnumbered">
<h3>Setting the Inputs</h3>
<p>Once you have downloaded the Excel Interface, you can open it in Excel. You will notice there are two sheets, labelled <strong>Model</strong> and <strong>Settings</strong>. Click on the <strong>Model</strong> tab.</p>
<p>You will notice several tables. The top two tables are input tables, which means that these are values you can change. For each package, we will provide details on what values are allowed. For example, <strong>Gender</strong> can be either <strong>Male</strong> or <strong>Female</strong>. Each package will have a User Guide, and you can find the acceptable inputs under the section <strong>Using the Package as an API - Excel API</strong>.</p>
<p>For this tutorial, go ahead and change <strong>Gender</strong> from <strong>Male</strong> to <strong>Female</strong>.</p>
</div>
<div id="section-running-the-model" class="section level3 unnumbered">
<h3>Running the Model</h3>
<p>To run the model, you need to connect to the model first.</p>
<ol style="list-style-type: decimal">
<li>Click on the <strong>Model</strong> sheet.</li>
<li>There is a button at the top of the page which says <strong>Connect to Model</strong>. Click on that button. On the bottom left of the Excel window, you should see the text “Connecting to model…”</li>
<li>Click on the <strong>Run</strong> button.</li>
<li>Click on the <strong>Disconnect from Model</strong> button once it has finished running.</li>
</ol>
</div>
</div>
<div id="section-api-in-R" class="section level2">
<h2><span class="header-section-number">3.2</span> PRISM API in R/Python/Bash/Javascript</h2>
<p>To get started, you will need to install a few packages:</p>
<head>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<script src="js/code-chunk-component.js"></script>
</head>

<code-chunk>
  <div slot="code">
    <div class="code-chunk">
      <code class="code mac">
      brew install curl </code>
      <code class="code linux">
      sudo apt install curl</code>
        <code class="code windows">
          <br>
        </code>
    <code class="code js">
    </code>
    <code class="code r active">
      install.packages("devtools") <br><br>
      devtools::install_github("resplab/prism")<br>
    </code>
    <code class="code python">
      pip3 install requests<br>
    </code></div>
  </div>
</code-chunk>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="js/list-group.js"></script>
<script src="js/code-chunk.js"></script>
<p>The next step is to get an API key. For now, we will be giving out API keys on a case-by-case basis, so please email either:</p>
<p>Amin Adibi: <a href="mailto:amin.adibi@ubc.ca" class="email">amin.adibi@ubc.ca</a></p>
<p>Mohsen Sadatsafavi: <a href="mailto:mohsen.sadatsafavi@ubc.ca" class="email">mohsen.sadatsafavi@ubc.ca</a></p>
<p>For the rest of this tutorial, I will be using one of the packages, <strong>accept</strong>, as the example. For a complete list of models, go to:</p>
<p><a href="http://resp.core.ubc.ca/ipress/prism">PRISM Model Repository</a></p>
<div id="section-get-1" class="section level3 unnumbered">
<h3>GET</h3>
<code-chunk>
  <div slot="code">
    <div class="code-chunk">
    <code class="code mac">
      curl -X GET http://prism.resp.core.ubc.ca/ocpu/library/acceptPrism/R/samplePatients/json </code>
      <code class="code linux">
      curl -X GET http://prism.resp.core.ubc.ca/ocpu/library/acceptPrism/R/samplePatients/json<br>
      </code>
        <code class="code windows">
          <br>
        </code>
    <code class="code js">
      request = new XMLHttpRequest(); <br><br>
      request.open('GET', 'http://prism.resp.core.ubc.ca/ocpu/library/acceptPrism/R/samplePatients/json'       ); <br><br>
      request.send();<br>
    </code>
    <code class="code r active">
      library(prism) <br><br>
      <span class="hljs-function">connect_to_model</span>('MODEL_NAME', api_key = YOUR_API_KEY) <br><br>
      patient1 = accept::samplePatients[1,] <br><br>
      model_run(patient1) <br><br>
      res = as.data.frame(model_run(patient1))<br>
    </code>
    <code class="code python">
      import json <br><br>
      import requests <br><br>
    response = requests.get("http://prism.resp.core.ubc.ca/ocpu/library/acceptPrism/R/samplePatients/json")<br>
    </code>
</div></div></code-chunk>
<br>
</div>
<div id="section-post-1" class="section level3 unnumbered">
<h3>POST</h3>
<code-chunk>
  <div slot="code">
    <div class="code-chunk">
    <code class="code mac">
      curl -X POST -H "Content-Type: application/json" -d '{"api_key":[YOUR_API_KEY],"func":["prism_model_run"],<br>
"model_input":[{"ID":"10001","male":1,"age":70,"smoker":1,"FEV1":2.5,"height":1.68,"weight":65}]}' http://prism.resp.core.ubc.ca/ocpu/library/acceptPrism/R/gateway/json </code>
      <code class="code linux">
      curl -X POST -H "Content-Type: application/json" -d '{"api_key":[YOUR_API_KEY],"func":["prism_model_run"],<br>
"model_input":[{"ID":"10001","male":1,"age":70,"smoker":1,"FEV1":2.5,"height":1.68,"weight":65}]}' http://prism.resp.core.ubc.ca/ocpu/library/acceptPrism/R/gateway/json<br>
      </code>
        <code class="code windows">
          curl -Body '{"api_key":["YOUR_API_KEY"],"func":["prism_model_run"],"model_input":[{"ID":"10001","male":1,"age":70,"smoker":1,"FEV1":2.5,"height":1.68,"weight":65}]}' -Method POST -uri http://prism.resp.core.ubc.ca/ocpu/library/acceptPrism/R/gateway/json -Headers @{"Content-type"="application/json"}<br>
        </code>
    <code class="code js">
      let patient = JSON.stringify({<br>
  api_key: 123456,<br>
  func: ["prism_model_run"],<br>
  model_input: [{<br>
    ID: 10001,<br>
    male: 1,<br>
    age: 70,<br>
    smoker: 1,<br>
    FEV1: 2.5,<br>
    height: 1.68,<br>
    weight: 65<br>
  }]<br>
});<br>
request.open('POST', 'http://prism.resp.core.ubc.ca/ocpu/library/acceptPrism/R/gateway/json');<br>
request.setRequestHeader('Content-Type', 'application/json');<br>
request.send(patient);<br>
let results = request.response;<br>
    </code>
    <code class="code r active">
      library(prism) <br><br>
      <span class="hljs-function">connect_to_model</span>('MODEL_NAME', api_key = YOUR_API_KEY) <br><br>
      patient1 = accept::samplePatients[1,] <br><br>
      model_run(patient1) <br><br>
      res = as.data.frame(model_run(patient1))<br>
    </code>
    <code class="code python">
      api_key = 'YOUR_API_KEY' <br><br>
patientInput = [{<br>
"ID":"10001",<br>
"male":1,<br>
"age":70,<br>
"smoker":1,<br>
"FEV1":2.5,<br>
"height":1.68,<br>
"weight":65<br>
}] <br><br>
response = requests.post("http://prism.resp.core.ubc.ca/ocpu/library/acceptPrism/R/gateway/json",<br>
  json = {"api_key":[api_key],<br>
  "func": ["prism_model_run"],<br>
  "model_input": patientInput}) <br><br>
print(response) <br><br>
results = json.loads(response.text) <br><br>
print(results)<br>
    </code>
</div>
</div>
</code-chunk>
<link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.9/styles/default.min.css">
<link rel="stylesheet"
            href="highlightjs/styles/default.css">
<script src="js/highlight.pack.js"></script>
  <script>
    /*
Applies highlighting to all <pre><code>..</code></pre> blocks on a page.
*/
hljs.configure({useBR: true});
$("code-chunk code").each(function (i, e) {
    hljs.highlightBlock(e);
});
/*hljs.initHighlightingOnLoad();*/
  </script>







</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="section-api.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="book_assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="book_assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="book_assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true
});
});
</script>

</body>

</html>
