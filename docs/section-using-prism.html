<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Using the PRISM API | PRISM: PROGRAMMABLE INTERFACE FOR STATISTICAL &amp; SIMULATION MODELS</title>
  <meta name="description" content="3 Using the PRISM API | PRISM: PROGRAMMABLE INTERFACE FOR STATISTICAL &amp; SIMULATION MODELS" />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Using the PRISM API | PRISM: PROGRAMMABLE INTERFACE FOR STATISTICAL &amp; SIMULATION MODELS" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Using the PRISM API | PRISM: PROGRAMMABLE INTERFACE FOR STATISTICAL &amp; SIMULATION MODELS" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="section-api.html">

<script src="book_assets/jquery-2.2.3/jquery.min.js"></script>
<link href="book_assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










<link rel="stylesheet" href="pretty-styles.css" type="text/css" />
<link rel="stylesheet" href="cayman.css" type="text/css" />
<link rel="stylesheet" href="python.css" type="text/css" />
<link rel="stylesheet" href="shadow.css" type="text/css" />
<link rel="stylesheet" href="index.html" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="section-introduction.html"><a href="section-introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="section-api.html"><a href="section-api.html"><i class="fa fa-check"></i><b>2</b> Application Programming Interface (API)</a><ul>
<li class="chapter" data-level="" data-path="section-api.html"><a href="section-api.html#section-what-is-an-api"><i class="fa fa-check"></i>What is an API?</a></li>
<li class="chapter" data-level="" data-path="section-api.html"><a href="section-api.html#section-rest"><i class="fa fa-check"></i>REST</a><ul>
<li class="chapter" data-level="" data-path="section-api.html"><a href="section-api.html#section-get"><i class="fa fa-check"></i>GET</a></li>
<li class="chapter" data-level="" data-path="section-api.html"><a href="section-api.html#section-post"><i class="fa fa-check"></i>POST</a></li>
<li class="chapter" data-level="" data-path="section-api.html"><a href="section-api.html#section-put"><i class="fa fa-check"></i>PUT</a></li>
<li class="chapter" data-level="" data-path="section-api.html"><a href="section-api.html#section-delete"><i class="fa fa-check"></i>DELETE</a></li>
<li class="chapter" data-level="" data-path="section-api.html"><a href="section-api.html#section-summary"><i class="fa fa-check"></i>Summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="section-using-prism.html"><a href="section-using-prism.html"><i class="fa fa-check"></i><b>3</b> Using the PRISM API</a><ul>
<li class="chapter" data-level="3.1" data-path="section-using-prism.html"><a href="section-using-prism.html#section-api-in-excel"><i class="fa fa-check"></i><b>3.1</b> PRISM API in Excel</a></li>
<li class="chapter" data-level="3.2" data-path="section-using-prism.html"><a href="section-using-prism.html#section-api-in-R"><i class="fa fa-check"></i><b>3.2</b> PRISM API in R/Python/Bash/Javascript</a><ul>
<li class="chapter" data-level="" data-path="section-using-prism.html"><a href="section-using-prism.html#section-get-1"><i class="fa fa-check"></i>GET</a></li>
<li class="chapter" data-level="" data-path="section-using-prism.html"><a href="section-using-prism.html#section-post-1"><i class="fa fa-check"></i>POST</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">PRISM: PROGRAMMABLE INTERFACE FOR STATISTICAL &amp; SIMULATION MODELS</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="section-using-prism" class="section level1">
<h1><span class="header-section-number">3</span> Using the PRISM API</h1>
<p>If you donâ€™t have much programming experience, or if you want to use Excel, I would recommend doing the <a href="section-using-prism.html#section-api-in-excel">API in Excel</a>. Otherwise, you can choose your favourite programming language to get started:</p>
<!-- ```{r links, eval=TRUE, echo=FALSE} -->
<!-- library(htmltools) -->
<!-- rawHTML <- paste(readLines("link-buttons.html"), collapse="\n") -->
<!-- HTML(rawHTML) -->
<!-- ``` -->
<div id="section-api-in-excel" class="section level2">
<h2><span class="header-section-number">3.1</span> PRISM API in Excel</h2>
</div>
<div id="section-api-in-R" class="section level2">
<h2><span class="header-section-number">3.2</span> PRISM API in R/Python/Bash/Javascript</h2>
<p>To get started, you will need to install a few packages:</p>
<head>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<script src="js/code-chunk-component.js"></script>
</head>

<code-chunk>
  <div slot="code">
    <div class="code-chunk">
      <code class="code mac">
      brew install curl </code>
      <code class="code linux">
      sudo apt install curl</code>
        <code class="code windows">
          
        </code>
    <code class="code js">
    </code>
    <code class="code r active">
      install.packages("devtools") <br>
      devtools::install_github("resplab/prism")
    </code>
    <code class="code python">
      pip3 install requests
    </code></div>
  </div>
</code-chunk>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="js/list-group.js"></script>
<script src="js/code-chunk.js"></script>
<p>The next step is to get an API key. For now, we will be giving out API keys on a case-by-case basis, so please email either:</p>
<p>Amin Adibi: <a href="mailto:amin.adibi@ubc.ca" class="email">amin.adibi@ubc.ca</a></p>
<p>Mohsen Sadatsafavi: <a href="mailto:mohsen.sadatsafavi@ubc.ca" class="email">mohsen.sadatsafavi@ubc.ca</a></p>
<p>For the rest of this tutorial, I will be using one of the packages, <strong>accept</strong>, as the example. For a complete list of models, go to:</p>
<p><a href="http://resp.core.ubc.ca/ipress/prism">PRISM Model Repository</a></p>
<div id="section-get-1" class="section level3 unnumbered">
<h3>GET</h3>

<div class="code-chunk">

<div class="row">
  <div class="col-sm-11 no-gutters code-lang-col">
  <div class="btn-group float-right">
  <button type="button" class="btn btn-primary dropdown-toggle code-lang" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Language
  </button>
  <div class="dropdown-menu">
    <a class="dropdown-item" value = "mac" href="#mac">Shell (MAC)</a>
    <a class="dropdown-item" value = "linux" href="#linux">Shell (Linux)</a>
    <a class="dropdown-item" value = "windows" href="#windows">Shell (Windows)</a>
    <a class="dropdown-item" value = "js" href="#js">Javascript</a>
    <a class="dropdown-item" value = "r" href="#r">R</a>
    <a class="dropdown-item" value = "python" href="#python">Python</a>
  </div>
</div>
</div>
<div class="col-sm-1 no-gutters copy-col">
  <a href="#" class="btn btn-primary active copy-button float-left js-copy" role="button" aria-pressed="true">Copy</a>
</div>
</div>
    <code class="code mac">
      curl -X GET http://prism.resp.core.ubc.ca/ocpu/library/acceptPrism/R/samplePatients/json </code>
      <code class="code linux">
      curl -X GET http://prism.resp.core.ubc.ca/ocpu/library/acceptPrism/R/samplePatients/json
      </code>
        <code class="code windows">
          
        </code>
    <code class="code js">
      request = new XMLHttpRequest(); <br>
      request.open('GET', 'http://prism.resp.core.ubc.ca/ocpu/library/acceptPrism/R/samplePatients/json'       ); <br>
      request.send();
    </code>
    <code class="code r active">
      library(prism) <br>
      <span class="hljs-function">connect_to_model</span>('MODEL_NAME', api_key = YOUR_API_KEY) <br>
      patient1 = accept::samplePatients[1,] <br>
      model_run(patient1) <br>
      res = as.data.frame(model_run(patient1))
    </code>
    <code class="code python">
      import json <br>
      import requests <br>
    response = requests.get("http://prism.resp.core.ubc.ca/ocpu/library/acceptPrism/R/samplePatients/json")
    </code>
</div>
<br>
</div>
<div id="section-post-1" class="section level3 unnumbered">
<h3>POST</h3>

<div class="code-chunk">

<div class="row">
  <div class="col-sm-11 no-gutters code-lang-col">
  <div class="btn-group float-right">
  <button type="button" class="btn btn-primary dropdown-toggle code-lang" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Language
  </button>
  <div class="dropdown-menu">
    <a class="dropdown-item" value = "mac" href="#mac">Shell (MAC)</a>
    <a class="dropdown-item" value = "linux" href="#linux">Shell (Linux)</a>
    <a class="dropdown-item" value = "windows" href="#windows">Shell (Windows)</a>
    <a class="dropdown-item" value = "js" href="#js">Javascript</a>
    <a class="dropdown-item" value = "r" href="#r">R</a>
    <a class="dropdown-item" value = "python" href="#python">Python</a>
  </div>
</div>
</div>
<div class="col-sm-1 no-gutters copy-col">
  <a href="#" class="btn btn-primary active copy-button float-left js-copy" role="button" aria-pressed="true">Copy</a>
</div>
</div>
    <code class="code mac">
      curl -X POST -H "Content-Type: application/json" -d '{"api_key":[YOUR_API_KEY],"func":["prism_model_run"],
"model_input":[{"ID":"10001","male":1,"age":70,"smoker":1,"FEV1":2.5,"height":1.68,"weight":65}]}' http://prism.resp.core.ubc.ca/ocpu/library/acceptPrism/R/gateway/json </code>
      <code class="code linux">
      curl -X POST -H "Content-Type: application/json" -d '{"api_key":[YOUR_API_KEY],"func":["prism_model_run"],
"model_input":[{"ID":"10001","male":1,"age":70,"smoker":1,"FEV1":2.5,"height":1.68,"weight":65}]}' http://prism.resp.core.ubc.ca/ocpu/library/acceptPrism/R/gateway/json
      </code>
        <code class="code windows">
          curl -Body '{"api_key":["YOUR_API_KEY"],"func":["prism_model_run"],"model_input":[{"ID":"10001","male":1,"age":70,"smoker":1,"FEV1":2.5,"height":1.68,"weight":65}]}' -Method POST -uri http://prism.resp.core.ubc.ca/ocpu/library/acceptPrism/R/gateway/json -Headers @{"Content-type"="application/json"}
        </code>
    <code class="code js">
      let patient = JSON.stringify({
  api_key: 123456,
  func: ["prism_model_run"],
  model_input: [{
    ID: 10001,
    male: 1,
    age: 70,
    smoker: 1,
    FEV1: 2.5,
    height: 1.68,
    weight: 65
  }]
});
request.open('POST', 'http://prism.resp.core.ubc.ca/ocpu/library/acceptPrism/R/gateway/json');
request.setRequestHeader('Content-Type', 'application/json');
request.send(patient); 
let results = request.response;
    </code>
    <code class="code r active">
      library(prism) <br>
      <span class="hljs-function">connect_to_model</span>('MODEL_NAME', api_key = YOUR_API_KEY) <br>
      patient1 = accept::samplePatients[1,] <br>
      model_run(patient1) <br>
      res = as.data.frame(model_run(patient1))
    </code>
    <code class="code python">
      api_key = 'YOUR_API_KEY'
patientInput = [{
"ID":"10001",
"male":1,
"age":70,
"smoker":1,
"FEV1":2.5,
"height":1.68,
"weight":65
}]
response = requests.post("http://prism.resp.core.ubc.ca/ocpu/library/acceptPrism/R/gateway/json",
  json = {"api_key":[api_key],
  "func": ["prism_model_run"],
  "model_input": patientInput})
print(response)
results = json.loads(response.text)
print(results)
    </code>
</div>
<br>

<!-- # Using the Web Application {#webapp} -->
<!-- We have created a web application which can be found here: -->
<!-- ```{r, eval=TRUE, echo=FALSE} -->
<!-- library(htmltools) -->
<!-- rawHTML <- paste(readLines("webapp.html"), collapse="\n") -->
<!-- HTML(rawHTML) -->
<!-- ``` -->

<!-- For the POST request, we will send some patient data to the API, and should get a prediction back from the API. -->
<!-- We will put the results in a dictionary: -->
<!-- ```{python prism-python4, eval = TRUE, echo = TRUE, engine.path = pythonEngine} -->
<!-- resultsDict = json.loads(results[0]) -->
<!-- print(resultsDict) -->
<!-- columnNames = list(resultsDict.keys()) -->
<!-- print(columnNames) -->
<!-- ``` -->
<!-- To visualize the results using the package PrettyTable: -->
<!-- ```{python prism-python5, eval = TRUE, echo = TRUE, engine.path = pythonEngine} -->
<!-- from prettytable import PrettyTable -->
<!-- table = PrettyTable() -->
<!-- table = PrettyTable() -->
<!-- table.align["Year"] = "l" # Left align year -->
<!-- table.padding_width = 1 # One space between column edges and contents (default) -->
<!-- print(columnNames) -->
<!-- for col in columnNames: -->
<!--     table.add_column(col, resultsDict[col]) -->
<!-- print(table) -->
<!-- ``` -->
<!-- The **onreadystatechange** is an XMLHttpRequest event which updates when the ready state changes. The ready state can be either 1, 2, 3, or 4. -->
<!-- ```{r javascript1, eval = TRUE, echo = FALSE} -->
<!-- dev.off() -->
<!-- readyState = c(0, 1, 2, 3, 4) -->
<!-- values = c("Unsent", "Opened: open() has been called", -->
<!--            "Headers Received: send() has been called and headers are available", -->
<!--            "Loading: downloading; responseText holds partial data", -->
<!--            "Done: the operation is complete") -->
<!-- metadata = data.frame("readyState"=readyState, Description = values) -->
<!-- names(metadata) = c("Ready State", "Description") -->
<!-- ``` -->
<!-- ```{r javascript2, eval = TRUE, echo = FALSE} -->
<!-- knitr::kable( -->
<!--   metadata, booktabs = TRUE -->
<!-- ) -->
<!-- ``` -->
<!-- ```{js, eval=FALSE, echo=TRUE} -->
<!-- request.onreadystatechange = function() { -->
<!--             if(request.readyState === 4) { // -->
<!--                 if(request.status === 200) { -->
<!--                     console.log(request.responseText); -->
<!--                 } else { -->
<!--                        console.log(request.status); -->
<!--                 } -->
<!--             } -->
<!--         } -->
<!-- ``` -->
<!-- We need to set the request header to json, and then send our patient json to the PRISM server using the **request.send()** function. -->

<!-- # Appendix 1: Installing R {#appendix1} -->
<!-- This is a guide to installing R, geared mainly at beginner audiences. All the information below can be found at https://www.r-project.org/; I've just simplified it a bit. -->
<!-- ## Step 1: Mirrors -->
<!-- When you go the the R home page, you will see a link to [download R](https://cran.r-project.org/mirrors.html), which will take you to a list of mirrors. They are organized by country, so click on one that is close to your location. Since our group is based out of Vancouver, I will select one of the mirrors in Canada: [SFU Mirror](https://mirror.its.sfu.ca/mirror/CRAN/). -->
<!-- Once you have clicked on the closest mirror, you will be asked to choose what type of computer you have. -->
<!-- ## Mac OS X -->
<!-- If you are using a Mac (Apple) computer, click on the link for Mac OS X. You will be redirected to a page that says "R for Mac OS X." To install R, you want to click on one of the files ending in ".pkg". If your operating system is fairly up-to-date, scroll to "Latest Release" and click on the file that looks like "R-3.X.Y.pkg," with X and Y being numbers for the latest release. R should begin downloading, and your Mac package manager will pop up with the rest of the instructions. -->
<!-- If your operating system is older, you might want to scroll down to "Legacy Releases," and download one of those ".pkg" files instead. It should tell you on the page what version your computer should use. -->
<!-- ## Windows -->
<!-- If you are using Windows, click on the link for Windows. You will be redirected to a page that says "R for Windows." To install R, click on the link "base," and on the next page, "Download R 3.X.Y for Windows," where X and Y are the version numbers for the latest release. R should begin downloading. -->


</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="section-api.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="book_assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="book_assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="book_assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true
});
});
</script>

</body>

</html>
